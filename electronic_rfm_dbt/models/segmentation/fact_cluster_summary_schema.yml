version: 2

models:
  - name: fact_cluster_summary
    description: >
      Summary fact table for customer clusters, aggregating both lifetime and recent
      (90-day) revenues, along with key behavioral averages. 
      Each row represents one customer cluster.

    columns:
      - name: cluster
        description: "Cluster ID generated by K-Means model"
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2]   # update if have more clusters

      - name: customer_segment
        description: "Human-readable label for the cluster (e.g., Passive Long-Tenure Customers)"
        tests:
          - not_null

      - name: customer_count
        description: "Total number of customers assigned to the cluster"
        tests:
          - not_null
          - positive_values

      - name: avg_recency_days
        description: "Average recency (days since last purchase) for customers in the cluster"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

      - name: avg_frequency
        description: "Average number of transactions per customer in the cluster"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

      - name: avg_monetary
        description: "Average spend per customer in the cluster (lifetime)"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

      - name: avg_basket_size
        description: "Average number of products per purchase in the cluster"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

      - name: avg_tenure_days
        description: "Average tenure (days since first purchase) for customers in the cluster"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

      - name: lifetime_revenue
        description: "Total revenue (including add-ons) from all customers in the cluster"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0

      - name: recent_revenue_90days
        description: "Total revenue from customers in the cluster in the last 90 days of data"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
